<!DOCTYPE html>
<html>
<head>
    <title>Battle Arena - {{ hero.name }} vs {{ enemy.name }}</title>
    <style>
        /* 1. Dark Theme & Layout */
        body {
            background-color: #121212;
            color: #e0e0e0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .arena-container {
            display: flex; 
            justify-content: space-around; 
            align-items: center;
            width: 80%;
            padding: 50px;
            margin-top: 20px;
        }

        .character-card, .enemy-card {
            background: #1e1e1e;
            border: 2px solid #333;
            border-radius: 15px;
            padding: 30px;
            width: 280px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.7);
            position: relative; /* Needed for absolute positioning of icons */
            transition: transform 0.3s ease;
        }

        .character-card { border-color: #4a90e2; }
        .enemy-card { border-color: #e94e77; }

        /* 2. Animation Icons (Overlays) */
        .attack-overlay {
            position: absolute;
            font-size: 60px;
            opacity: 0;
            pointer-events: none;
            z-index: 100;
            top: 20%;
        }

        #heroSword { left: 50px; }
        #enemyClaw { right: 50px; }

        /* 3. Keyframes: Sword Strike & Claw Slash */
        @keyframes hero-strike {
            0% { opacity: 0; transform: translate(0, 0) rotate(-45deg); }
            20% { opacity: 1; }
            50% { transform: translate(350px, 20px) rotate(45deg); } /* Move to enemy */
            80% { opacity: 1; }
            100% { opacity: 0; transform: translate(400px, 40px) rotate(90deg); }
        }

        @keyframes enemy-strike {
            0% { opacity: 0; transform: translate(0, 0) scale(1); }
            20% { opacity: 1; }
            50% { transform: translate(-350px, -20px) scale(1.8); color: #ef4444; } /* Move to hero */
            80% { opacity: 1; }
            100% { opacity: 0; transform: translate(-400px, -40px) scale(1); }
        }

        /* Screen Shake for damage feedback */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-15px); }
            50% { transform: translateX(15px); }
            75% { transform: translateX(-15px); }
        }

        .animate-hero { animation: hero-strike 0.6s ease-in-out forwards; }
        .animate-enemy { animation: enemy-strike 0.6s ease-in-out forwards; }
        .apply-shake { animation: shake 0.3s ease-in-out; }

        /* 4. UI Elements */
        .attack-btn {
            background-color: #e94e77;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 15px 50px;
            font-size: 1.8rem;
            cursor: pointer;
            font-weight: bold;
            transition: 0.3s;
        }

        .attack-btn:hover {
            background-color: #ff5e88;
            box-shadow: 0 0 20px #e94e77;
        }
    </style>
</head>
<body>

    <div class="arena-container">
        <div class="character-card" id="heroCard">
            <div id="heroSword" class="attack-overlay">‚öîÔ∏è</div>
            <h2>üõ°Ô∏è {{ hero.name }}</h2>
            <p>HP: <strong style="color: #4ade80;">{{ hero.health }}</strong></p>
            <p>Strength: <strong>{{ hero.strength }}</strong></p>
            <p>Level: {{ hero.level }}</p>
        </div>

        <h1 style="color: #444; font-size: 3rem;">VS</h1>

        <div class="enemy-card" id="enemyCard">
            <div id="enemyClaw" class="attack-overlay">üêæ</div>
            <h2>üëπ {{ enemy.name }}</h2>
            <p>HP: <strong style="color: #ef4444;">{{ enemy.health }}</strong></p>
            <p>Attack Power: <strong>{{ enemy.attack_power }}</strong></p>
        </div>
    </div>

    <div style="text-align: center;">
        <form id="battleForm" action="{% url 'attack_enemy' hero.id %}" method="POST" onsubmit="runBattleAnimation(event)">
            {% csrf_token %}
            <button type="submit" class="attack-btn">‚öîÔ∏è Attack!</button>
        </form>
        <br>
        <a href="{% url 'character_detail' hero.id %}" style="color: #666; text-decoration: none;">üèÉ Flee Battle</a>
    </div>

    <script>
        function runBattleAnimation(event) {
            event.preventDefault(); // Stop form submission
            const form = event.target;
            
            const sword = document.getElementById('heroSword');
            const claw = document.getElementById('enemyClaw');
            const heroCard = document.getElementById('heroCard');
            const enemyCard = document.getElementById('enemyCard');

            // 1. Hero Attacks
            sword.classList.add('animate-hero');

            // 2. Enemy receives hit (Shake) then counters
            setTimeout(() => {
                enemyCard.classList.add('apply-shake');
                claw.classList.add('animate-enemy');
            }, 500);

            // 3. Hero receives counter-hit (Shake)
            setTimeout(() => {
                heroCard.classList.add('apply-shake');
            }, 900);

            // 4. Final step: Submit to Django to update database
            setTimeout(() => {
                form.submit();
            }, 1300);
        }
    </script>
</body>
</html>